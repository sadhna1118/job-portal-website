{% extends "base.html" %}

{% block title %}Saved Jobs - Job Portal{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1 class="page-title">Saved Jobs</h1>
        <p class="page-subtitle">Your saved job listings</p>
    </div>
</div>

<div class="container" style="margin-top: 2rem;">
    {% if saved_jobs_pagination.items %}
    <div class="jobs-list">
        {% for saved_job in saved_jobs_pagination.items %}
        {% set job = saved_job.job %}
        <div class="job-list-item" data-job-id="{{ job.id }}">
            <div class="job-list-content">
                <div class="job-list-header">
                    <h3 class="job-list-title">
                        <a href="{{ url_for('job_detail', job_id=job.id) }}" class="link">
                            {{ job.title }}
                        </a>
                    </h3>
                    <span class="job-type-badge">{{ job.job_type or 'Full-time' }}</span>
                </div>
                <p class="job-list-company">{{ job.company }}</p>
                
                <div class="job-meta">
                    <span class="meta-item">
                        <i class="icon-map-pin"></i>
                        {{ job.location }}
                    </span>
                    
                    {% if job.salary %}
                    <span class="meta-item">
                        <i class="icon-dollar-sign"></i>
                        {{ job.salary }}
                    </span>
                    {% endif %}
                    
                    <span class="meta-item">
                        <i class="icon-bookmark"></i>
                        Saved on {{ saved_job.saved_at.strftime('%b %d, %Y') }}
                    </span>
                </div>
            </div>
            
            <div class="job-list-actions" style="display: flex; gap: var(--spacing-sm);">
                <a href="{{ url_for('job_detail', job_id=job.id) }}" class="btn-primary">
                    View Details
                </a>
                <button onclick="unsaveJob({{ job.id }})" class="btn-secondary">
                    <i class="icon-trash-2"></i>
                    Remove
                </button>
            </div>
        </div>
        {% endfor %}
        
        <!-- Pagination -->
        {% if saved_jobs_pagination.pages > 1 %}
        <div style="margin-top: 2rem; display: flex; justify-content: center; gap: var(--spacing-sm); align-items: center;">
            {% if saved_jobs_pagination.has_prev %}
            <a href="{{ url_for('saved_jobs', page=saved_jobs_pagination.prev_num) }}" 
               class="btn-secondary">
                <i class="icon-chevron-left"></i>
                Previous
            </a>
            {% endif %}
            
            <span class="text-muted">
                Page {{ saved_jobs_pagination.page }} of {{ saved_jobs_pagination.pages }}
            </span>
            
            {% if saved_jobs_pagination.has_next %}
            <a href="{{ url_for('saved_jobs', page=saved_jobs_pagination.next_num) }}" 
               class="btn-secondary">
                Next
                <i class="icon-chevron-right"></i>
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="icon-bookmark"></i>
        <h3>No saved jobs</h3>
        <p>Save jobs that interest you to find them here later.</p>
        <a href="{{ url_for('jobs') }}" class="btn-primary">Browse Jobs</a>
    </div>
    {% endif %}
</div>

<script>
function unsaveJob(jobId) {
    if (!confirm('Remove this job from saved jobs?')) {
        return;
    }
    
    fetch(`/job/${jobId}/save`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (!data.saved) {
            // Remove the job card from the UI
            const jobCard = document.querySelector(`[data-job-id="${jobId}"]`);
            if (jobCard) {
                jobCard.remove();
                
                // If no more jobs, reload to show empty state
                if (document.querySelectorAll('[data-job-id]').length === 0) {
                    window.location.reload();
                }
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    });
}
</script>
{% endblock %}